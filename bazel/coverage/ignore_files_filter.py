"""Filters out ignored source files

- Reads a list of files from stdin
- Writes a list of unignored files to stdout
"""
import itertools as IT
import sys


def main():
  # directory subtrees omitted from consideration
  skip = [
      # tests
      'tools/adt/idea/adt-branding/testSrc',
      'tools/adt/idea/adt-ui-model/testSrc',
      'tools/adt/idea/adt-ui/src/test',
      'tools/adt/idea/android-adb/testSrc',
      'tools/adt/idea/android-common/test',
      'tools/adt/idea/android-debuggers/testSrc',
      'tools/adt/idea/android-kotlin/android-extensions-idea/testData',
      'tools/adt/idea/android-kotlin/android-extensions-idea/tests',
      'tools/adt/idea/android-kotlin/android-extensions-jps/testData',
      'tools/adt/idea/android-kotlin/idea-android/testData',
      'tools/adt/idea/android-kotlin/idea-android/tests',
      'tools/adt/idea/android-lang-databinding/testSrc',
      'tools/adt/idea/android-lang/testSrc',
      'tools/adt/idea/android-layout-inspector/testSrc',
      'tools/adt/idea/android-templates/testSrc',
      'tools/adt/idea/android-test-framework/testSrc',
      'tools/adt/idea/android-transport/testSrc',
      'tools/adt/idea/android-uitests/testData',
      'tools/adt/idea/android-uitests/testSrc',
      'tools/adt/idea/android/testData',
      'tools/adt/idea/android/testSrc',
      'tools/adt/idea/apkanalyzer/testSrc',
      'tools/adt/idea/app-inspection/api/testSrc',
      'tools/adt/idea/app-inspection/ide/testSrc',
      'tools/adt/idea/assistant/testSrc',
      'tools/adt/idea/build-attribution/testSrc',
      'tools/adt/idea/build-common/testSrc',
      'tools/adt/idea/compose-designer/testSrc',
      'tools/adt/idea/connection-assistant/testSrc',
      'tools/adt/idea/databinding/testData',
      'tools/adt/idea/databinding/testSrc',
      'tools/adt/idea/deploy/testSrc',
      'tools/adt/idea/designer/customview/testSrc',
      'tools/adt/idea/designer/testData',
      'tools/adt/idea/designer/testSrc',
      'tools/adt/idea/gradle-tooling/studio-gradle-tooling-impl/testSrc',
      'tools/adt/idea/jps-plugin/testData',
      'tools/adt/idea/jps-plugin/testSrc',
      'tools/adt/idea/kotlin-integration/testData',
      'tools/adt/idea/kotlin-integration/testSrc',
      'tools/adt/idea/layout-inspector/testSrc',
      'tools/adt/idea/layout-ui/src/test',
      'tools/adt/idea/layoutlib-loader/testSrc',
      'tools/adt/idea/native-symbolizer/testSrc',
      'tools/adt/idea/nav/editor/testSrc',
      'tools/adt/idea/observable-ui/testSrc',
      'tools/adt/idea/observable/testSrc',
      'tools/adt/idea/transport-database/testSrc',
      'tools/adt/idea/profilers-android/testSrc',
      'tools/adt/idea/profilers-ui/testSrc',
      'tools/adt/idea/profilers/testSrc',
      'tools/adt/idea/project-system-gradle/testSrc',
      'tools/adt/idea/project-system/testSrc',
      'tools/adt/idea/resources-base/testSrc',
      'tools/adt/idea/sdk-updates/testSrc',
      'tools/adt/idea/smali/testSrc',
      'tools/adt/idea/swingp/testSrc',
      'tools/adt/idea/uitest-framework-bazel/testSrc',
      'tools/adt/idea/uitest-framework-gradle/testSrc',
      'tools/adt/idea/uitest-framework/testSrc',
      'tools/adt/idea/whats-new-assistant/testSrc',
      'tools/adt/idea/wizard-model/testSrc',
      'tools/analytics-library/crash/src/test',
      'tools/analytics-library/publisher/src/test',
      'tools/analytics-library/shared/src/test',
      'tools/analytics-library/testing/src/test',
      'tools/analytics-library/tracker/src/test',
      'tools/apksig/src/test',
      'tools/apkzlib/src/test',
      'tools/base/apkparser/analyzer/src/test',
      'tools/base/apkparser/binary-resources/src/test',
      'tools/base/apkparser/cli/src/test',
      'tools/base/aspects_agent/src/test',
      'tools/base/bazel/test',
      'tools/base/bazel/testSrc',
      'tools/base/build-system/builder-model/src/test',
      'tools/base/build-system/builder-test-api/src/test',
      'tools/base/build-system/builder/src/test',
      'tools/base/build-system/gradle-api/src/test',
      'tools/base/build-system/gradle-core/src/test',
      'tools/base/build-system/gradle-experimental/src/test',
      'tools/base/build-system/integration-test/application/src/test',
      'tools/base/build-system/integration-test/databinding/src/test',
      'tools/base/build-system/integration-test/framework/src/test',
      'tools/base/build-system/integration-test/native/src/test',
      'tools/base/build-system/integration-test/test-projects',
      'tools/base/build-system/manifest-merger/src/test',
      'tools/base/build-system/profile/src/test',
      'tools/base/common/src/test',
      'tools/base/ddmlib/src/test',
      'tools/base/deploy/deployer/src/test',
      'tools/base/deploy/test',
      'tools/base/draw9patch/src/test',
      'tools/base/dynamic-layout-inspector/src/test',
      'tools/base/fakeadbserver/src/test',
      'tools/base/flags/src/test',
      'tools/base/layoutinspector/testSrc',
      'tools/base/layoutlib-api/sample/testproject',
      'tools/base/layoutlib-api/src/test',
      'tools/base/lint/libs/lint-gradle/src/test',
      'tools/base/lint/libs/lint-tests/src/test',
      'tools/base/lint/studio-checks/src/test',
      'tools/base/mlkit-common/src/test',
      'tools/base/ninepatch/src/test',
      'tools/base/perf-logger/src/test',
      'tools/base/perflib/src/test',
      'tools/base/pixelprobe/src/test',
      'tools/base/profiler/app/supportlib/src/test',
      'tools/base/profiler/integration-tests',
      'tools/base/profiler/tests',
      'tools/base/repository/src/test',
      'tools/base/sdk-common/src/test',
      'tools/base/sdklib/src/test',
      'tools/base/testutils/src/test',
      'tools/base/tracer/agent/testSrc',
      'tools/base/usb-devices/testSrc',
      'tools/base/vector-drawable-tool/src/test',
      'tools/buildSrc/src/test',
      'tools/data-binding/compilationTests/src/test',
      'tools/data-binding/compiler/src/test',
      'tools/data-binding/compilerCommon/src/test',
      'tools/data-binding/exec/src/test',
      'tools/data-binding/extensions-support/library/src/androidTest',
      'tools/data-binding/extensions/library/src/androidTest',
      'tools/data-binding/integration-tests-support',
      'tools/data-binding/integration-tests',
      'tools/data-binding/samples',
      'tools/dx/dalvik/dx/junit-tests',
      'tools/dx/dalvik/dx/tests',
      'tools/vendor/google/android-apk/testData',
      'tools/vendor/google/android-apk/testSrc',
      'tools/vendor/google/android-ndk/testData',
      'tools/vendor/google/android-ndk/testSrc',
      # generated
      'tools/adt/idea/android-lang-databinding/gen',
      'tools/adt/idea/android-lang/gen',
      'tools/adt/idea/artwork/gen',
      'tools/adt/idea/smali/gen',
      # external
      'tools/base/jobb',
      'tools/base/zipflinger',
      'tools/dx',
      'tools/external',
      'tools/idea',
      'tools/sherpa',
      'tools/studio',
      'tools/swing-testing',
      'tools/swt',
      'tools/vendor/adt_infra_internal',
      'tools/vendor/galvsoft',
      'tools/vendor/google/aapt2-prebuilt',
      'tools/vendor/google/adrt',
      'tools/vendor/google/CloudEndpoints',
      'tools/vendor/google/cpp-integration-tests',
      'tools/vendor/google/docs',
      'tools/vendor/google/dogfood',
      'tools/vendor/google/firebase',
      'tools/vendor/google/games',
      'tools/vendor/google/GooglePlayLog',
      'tools/vendor/google/installer',
      'tools/vendor/google/JenkinsPresubmit',
      'tools/vendor/google/layoutlib-prebuilt',
      'tools/vendor/google/lldb-integration-tests',
      'tools/vendor/google/real-world-integration-test',
      'tools/vendor/google/scripts',
      'tools/vendor/google/testing',
      'tools/vendor/google/TranslationPluginForEclipse',
      'tools/vendor/google/url-assistant',
      'tools/vendor/google/WinLauncher2',
      'tools/vendor/google3',
      'tools/vendor/intel',
      'tools/vendor/intellij',
  ]
  # file extensions we care about
  ends = [
      '.java',
      '.kt',
  ]

  for path in sys.stdin:
    path = path.strip()
    # ignore skipped directories
    if any(IT.imap(path.startswith, skip)):
      continue
    # ignore non-source files
    if not any(IT.imap(path.endswith, ends)):
      continue
    sys.stdout.write(path + "\n")

if __name__ == '__main__':
  main()
