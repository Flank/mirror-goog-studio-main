"""Aspect to validate that only the specified targets use eternal timeout.

When bazel is invoked with this aspect attached, it validates that only
the allowlisted targets below can use the eternal timeout.
"""
APPROVED_ETERNAL_TESTS = [
    "//tools/vendor/google/android-apk:android-apk.tests_tests",
    "//tools/base/build-system/integration-test/native:VulkanTest",
    "//tools/base/build-system/integration-test/native:V2NativeModelTest",
    "//tools/base/build-system/integration-test/native:RsSupportModeTest",
    "//tools/base/build-system/integration-test/native:RsEnabledAnnotationTest",
    "//tools/base/build-system/integration-test/native:RenderscriptNdkTest",
    "//tools/base/build-system/integration-test/native:PrefabTest",
    "//tools/base/build-system/integration-test/native:PrefabPublishingTest",
    "//tools/base/build-system/integration-test/native:Pre21SplitTest",
    "//tools/base/build-system/integration-test/native:NoSplitNdkVariantsTest",
    "//tools/base/build-system/integration-test/native:NdkSanAngelesTest",
    "//tools/base/build-system/integration-test/native:NdkPrebuiltsTest",
    "//tools/base/build-system/integration-test/native:NdkLibPrebuiltsTest",
    "//tools/base/build-system/integration-test/native:NdkJniLibTest",
    "//tools/base/build-system/integration-test/native:NdkBuildTest",
    "//tools/base/build-system/integration-test/native:NdkBuildTargetsTest",
    "//tools/base/build-system/integration-test/native:NdkBuildJniLibTest",
    "//tools/base/build-system/integration-test/native:NdkBuildBuildSettingsTest",
    "//tools/base/build-system/integration-test/native:NdkBuildAndroidMkLibraryTest",
    "//tools/base/build-system/integration-test/native:NativeBuildOutputTest",
    "//tools/base/build-system/integration-test/native:MergeNativeDebugMetadataTaskTest",
    "//tools/base/build-system/integration-test/native:InjectedAbiNativeLibraryTest",
    "//tools/base/build-system/integration-test/native:HeaderInCmakeListsTest",
    "//tools/base/build-system/integration-test/native:ExtractNativeDebugMetadataTaskTest",
    "//tools/base/build-system/integration-test/native:CombinedAbiDensitySplits",
    "//tools/base/build-system/integration-test/native:CmakeTargetsTest",
    "//tools/base/build-system/integration-test/native:CmakeSysrootTest",
    "//tools/base/build-system/integration-test/native:CmakeStlMatrixTest",
    "//tools/base/build-system/integration-test/native:CmakeSettingsTest",
    "//tools/base/build-system/integration-test/native:CmakeSettingsSharedBuildTest",
    "//tools/base/build-system/integration-test/native:CmakeMultiModuleTest",
    "//tools/base/build-system/integration-test/native:CmakeJniLibTest",
    "//tools/base/build-system/integration-test/native:CmakeInjectedAbiSplitTest",
    "//tools/base/build-system/integration-test/native:CmakeGradleTargetsTest",
    "//tools/base/build-system/integration-test/native:CmakeExtensionsTest",
    "//tools/base/build-system/integration-test/native:CmakeBasicProjectTest",
    "//tools/base/build-system/integration-test/native:CMakeBuildSettingsTest",
    "//tools/base/build-system/integration-test/application/src/test/java/com/android/build/gradle/integration/testing/unit:tests",
    "//tools/base/build-system/integration-test/application/src/test/java/com/android/build/gradle/integration/sdk:sdk_tests",
    "//tools/base/build-system/integration-test/application/src/test/java/com/android/build/gradle/integration/gradlecompat:GradleVersionCheckTest",
    "//tools/base/build-system/integration-test/application:tests__library.MultiprojectTest",
    "//tools/base/build-system/integration-test/application:tests__library.DslTest",
    "//tools/base/build-system/integration-test/application:coupled_tests",
    "//tools/base/build-system/integration-test/application:tests__WindowsSystemDependencyTest",
    "//tools/base/build-system/integration-test/application:tests__WearWithCustomApplicationIdTest",
    "//tools/base/build-system/integration-test/application:tests__WearVariantTest",
    "//tools/base/build-system/integration-test/application:tests__WearSimpleUnbundledTest",
    "//tools/base/build-system/integration-test/application:tests__WearSimpleTest",
    "//tools/base/build-system/integration-test/application:tests__VectorDrawableTest_Library",
    "//tools/base/build-system/integration-test/application:tests__VectorDrawableTest",
    "//tools/base/build-system/integration-test/application:tests__VariantsApiTest",
    "//tools/base/build-system/integration-test/application:tests__VariantFilteringTest",
    "//tools/base/build-system/integration-test/application:tests__VariantDependencyTest",
    "//tools/base/build-system/integration-test/application:tests__VariantApiPropertiesTest",
    "//tools/base/build-system/integration-test/application:tests__VariantApiMisuseTest",
    "//tools/base/build-system/integration-test/application:tests__VariantApiLibraryPropertiesTest",
    "//tools/base/build-system/integration-test/application:tests__VariantApiCustomizationTest",
    "//tools/base/build-system/integration-test/application:tests__VariantApiCompatTest",
    "//tools/base/build-system/integration-test/application:tests__VariantApiArtifactAccessTest",
    "//tools/base/build-system/integration-test/application:tests__ValidateTaskPropertiesTest",
    "//tools/base/build-system/integration-test/application:tests__UseEmbeddedDexPackagingTest",
    "//tools/base/build-system/integration-test/application:tests__TransformVariantApiTest",
    "//tools/base/build-system/integration-test/application:tests__TransformInModuleWithKotlinTest",
    "//tools/base/build-system/integration-test/application:tests__TransformApiTest",
    "//tools/base/build-system/integration-test/application:tests__TictactoeTest",
    "//tools/base/build-system/integration-test/application:tests__TextureTargetedAssetPackTest",
    "//tools/base/build-system/integration-test/application:tests__TestingSupportLibraryTest",
    "//tools/base/build-system/integration-test/application:tests__TestWithSameDepAsAppWithProguard",
    "//tools/base/build-system/integration-test/application:tests__TestWithSameDepAsAppWithClassifier",
    "//tools/base/build-system/integration-test/application:tests__TestWithSameDepAsApp",
    "//tools/base/build-system/integration-test/application:tests__TestWithRemoteAndroidLibDepTest",
    "//tools/base/build-system/integration-test/application:tests__TestWithMismatchDep",
    "//tools/base/build-system/integration-test/application:tests__TestWithJavaLibDepTest",
    "//tools/base/build-system/integration-test/application:tests__TestWithFlavorsWithCompileDirectJarTest",
    "//tools/base/build-system/integration-test/application:tests__TestWithDepTest",
    "//tools/base/build-system/integration-test/application:tests__TestWithCompileLibTest",
    "//tools/base/build-system/integration-test/application:tests__TestWithCompileDirectJarTest",
    "//tools/base/build-system/integration-test/application:tests__TestWithAndroidLibDepTest",
    "//tools/base/build-system/integration-test/application:tests__TestOptionsExecutionTest",
    "//tools/base/build-system/integration-test/application:tests__TestLibraryWithDep",
    "//tools/base/build-system/integration-test/application:tests__SwitchMultidexTest",
    "//tools/base/build-system/integration-test/application:tests__StripDebugSymbolsTaskTest",
    "//tools/base/build-system/integration-test/application:tests__StableResourceIDsTest",
    "//tools/base/build-system/integration-test/application:tests__SplitHandlingTest",
    "//tools/base/build-system/integration-test/application:tests__SpecialCharactersBasicTest",
    "//tools/base/build-system/integration-test/application:tests__SourceSetsTaskTest",
    "//tools/base/build-system/integration-test/application:tests__SourceSetFilteringTest",
    "//tools/base/build-system/integration-test/application:tests__SimpleCompositeBuildTest",
    "//tools/base/build-system/integration-test/application:tests__ShrinkResourcesOldShrinkerTest",
    "//tools/base/build-system/integration-test/application:tests__ShrinkResourcesNewShrinkerTest",
    "//tools/base/build-system/integration-test/application:tests__SeparateTestWithoutMinificationWithDependenciesTest",
    "//tools/base/build-system/integration-test/application:tests__SeparateTestWithMinificationButNoObfuscationTest",
    "//tools/base/build-system/integration-test/application:tests__SeparateTestWithDependenciesTest",
    "//tools/base/build-system/integration-test/application:tests__SeparateTestWithAarDependencyTest",
    "//tools/base/build-system/integration-test/application:tests__SeparateTestModuleWithVariantsTest",
    "//tools/base/build-system/integration-test/application:tests__SeparateTestModuleWithMinifiedAppTest",
    "//tools/base/build-system/integration-test/application:tests__SeparateTestModuleWithAppDependenciesTest",
    "//tools/base/build-system/integration-test/application:tests__SeparateTestModuleTest",
    "//tools/base/build-system/integration-test/application:tests__SameNamedLibsTest",
    "//tools/base/build-system/integration-test/application:tests__RewriteLocalLibraryResourceNamespaceTest",
    "//tools/base/build-system/integration-test/application:tests__ResourcesOverridingTest",
    "//tools/base/build-system/integration-test/application:tests__ResourceValidationTest",
    "//tools/base/build-system/integration-test/application:tests__ResourceNamespaceOverrideTest",
    "//tools/base/build-system/integration-test/application:tests__ResourceNamespaceLibrariesTest",
    "//tools/base/build-system/integration-test/application:tests__ResValueTypeTest",
    "//tools/base/build-system/integration-test/application:tests__ResValueTest",
    "//tools/base/build-system/integration-test/application:tests__ResPackagingTest",
    "//tools/base/build-system/integration-test/application:tests__RepoTest",
    "//tools/base/build-system/integration-test/application:tests__RenderscriptTest",
    "//tools/base/build-system/integration-test/application:tests__RenderScriptLinkerTest",
    "//tools/base/build-system/integration-test/application:tests__RenamedApkTest",
    "//tools/base/build-system/integration-test/application:tests__RegisterExternalAptJavaOutputTest",
    "//tools/base/build-system/integration-test/application:tests__RClassPackageTest",
    "//tools/base/build-system/integration-test/application:tests__R8TaskTest",
    "//tools/base/build-system/integration-test/application:tests__PublishLegacyMultidexLibTest",
    "//tools/base/build-system/integration-test/application:tests__PseudoLocalizationTest",
    "//tools/base/build-system/integration-test/application:tests__ProjectNoJavaSourcesTest",
    "//tools/base/build-system/integration-test/application:tests__ProguardDesugaringTest",
    "//tools/base/build-system/integration-test/application:tests__ProguardAarPackagingTest",
    "//tools/base/build-system/integration-test/application:tests__ProfileContentTest",
    "//tools/base/build-system/integration-test/application:tests__ProfileCapturerTest",
    "//tools/base/build-system/integration-test/application:tests__ProcessTestManifestTest",
    "//tools/base/build-system/integration-test/application:tests__PrivateResourcesTest",
    "//tools/base/build-system/integration-test/application:tests__PrivateResourceTest",
    "//tools/base/build-system/integration-test/application:tests__PrecompileRemoteResourcesTest",
    "//tools/base/build-system/integration-test/application:tests__PostprocessingTest",
    "//tools/base/build-system/integration-test/application:tests__PluginVersionCheckTest",
    "//tools/base/build-system/integration-test/application:tests__PlatformLoaderTest",
    "//tools/base/build-system/integration-test/application:tests__PlaceholderInLibsTest",
    "//tools/base/build-system/integration-test/application:tests__PartialRTest",
    "//tools/base/build-system/integration-test/application:tests__ParseLibraryResourcesPartialRTest",
    "//tools/base/build-system/integration-test/application:tests__ParentLibsTest",
    "//tools/base/build-system/integration-test/application:tests__ParameterizedModelTest",
    "//tools/base/build-system/integration-test/application:tests__PackagingOptionsTest",
    "//tools/base/build-system/integration-test/application:tests__PackagingOptionsFilteringTest",
    "//tools/base/build-system/integration-test/application:tests__OverlayableResourcesTest",
    "//tools/base/build-system/integration-test/application:tests__Overlay3Test",
    "//tools/base/build-system/integration-test/application:tests__Overlay2Test",
    "//tools/base/build-system/integration-test/application:tests__Overlay1Test",
    "//tools/base/build-system/integration-test/application:tests__OutputRenamingTest",
    "//tools/base/build-system/integration-test/application:tests__OptionalLibraryWithProguardTest",
    "//tools/base/build-system/integration-test/application:tests__OptionalLibraryTest",
    "//tools/base/build-system/integration-test/application:tests__OptionalAarTest",
    "//tools/base/build-system/integration-test/application:tests__OlderStudioModel",
    "//tools/base/build-system/integration-test/application:tests__ObsoleteApiTest",
    "//tools/base/build-system/integration-test/application:tests__NonTransitiveCompileRClassFlowTest",
    "//tools/base/build-system/integration-test/application:tests__NonTransitiveAppRClassesTest",
    "//tools/base/build-system/integration-test/application:tests__NonNamespacedCompileRClassTest",
    "//tools/base/build-system/integration-test/application:tests__NonNamespacedApplicationLightRClassesTest",
    "//tools/base/build-system/integration-test/application:tests__NoOpIncrementalBuildTaskStatesTest",
    "//tools/base/build-system/integration-test/application:tests__NoOpIncrementalBuildMinifyTest",
    "//tools/base/build-system/integration-test/application:tests__NoMappingTest",
    "//tools/base/build-system/integration-test/application:tests__NoManifestTest",
    "//tools/base/build-system/integration-test/application:tests__NoCruncherTest",
    "//tools/base/build-system/integration-test/application:tests__NoCompressTest",
    "//tools/base/build-system/integration-test/application:tests__NativeSoPackagingTest",
    "//tools/base/build-system/integration-test/application:tests__NativeSoPackagingOptionsTest",
    "//tools/base/build-system/integration-test/application:tests__NativeSoPackagingFromRemoteAarTest",
    "//tools/base/build-system/integration-test/application:tests__NativeSoPackagingFromJarTest",
    "//tools/base/build-system/integration-test/application:tests__NativeSoPackagingDirectSubprojectAarTest",
    "//tools/base/build-system/integration-test/application:tests__NamespacedDynamicFeatureIntegrationTest",
    "//tools/base/build-system/integration-test/application:tests__NamespacedApplicationLightRClassesTest",
    "//tools/base/build-system/integration-test/application:tests__NamespacedAarTest",
    "//tools/base/build-system/integration-test/application:tests__MultiresTest",
    "//tools/base/build-system/integration-test/application:tests__MultiProjectTest",
    "//tools/base/build-system/integration-test/application:tests__MultiDexWithLibTest",
    "//tools/base/build-system/integration-test/application:tests__MultiDexCacheTest",
    "//tools/base/build-system/integration-test/application:tests__MultiCompositeBuildTest",
    "//tools/base/build-system/integration-test/application:tests__ModelWithDataBindingTest",
    "//tools/base/build-system/integration-test/application:tests__ModelTest",
    "//tools/base/build-system/integration-test/application:tests__ModelInstantAppCompatibleTest",
    "//tools/base/build-system/integration-test/application:tests__MlModelBindingInLibTest",
    "//tools/base/build-system/integration-test/application:tests__MlGeneratedClassTest",
    "//tools/base/build-system/integration-test/application:tests__MistypedSourceSetTest",
    "//tools/base/build-system/integration-test/application:tests__MissingSdkTest",
    "//tools/base/build-system/integration-test/application:tests__MissingDimensionStrategyTest",
    "//tools/base/build-system/integration-test/application:tests__MissingCompileSdkVersionTest",
    "//tools/base/build-system/integration-test/application:tests__MisplacedMissingDimensionStrategyTest",
    "//tools/base/build-system/integration-test/application:tests__MinimalKeepRulesTest",
    "//tools/base/build-system/integration-test/application:tests__MinifyTest",
    "//tools/base/build-system/integration-test/application:tests__MinifyLibTest",
    "//tools/base/build-system/integration-test/application:tests__MinifyLibProvidedDepTest",
    "//tools/base/build-system/integration-test/application:tests__MinifyLibAndAppWithJavaResTest",
    "//tools/base/build-system/integration-test/application:tests__MinifyLibAndAppKeepRules",
    "//tools/base/build-system/integration-test/application:tests__MinifyFeaturesTest",
    "//tools/base/build-system/integration-test/application:tests__MinifyCacheabilityTest",
    "//tools/base/build-system/integration-test/application:tests__MigratedTest",
    "//tools/base/build-system/integration-test/application:tests__MessageRewriteWithJvmResCompilerTest",
    "//tools/base/build-system/integration-test/application:tests__MessageRewriteTest",
    "//tools/base/build-system/integration-test/application:tests__MessageRewrite2Test",
    "//tools/base/build-system/integration-test/application:tests__MergeResourcesTest",
    "//tools/base/build-system/integration-test/application:tests__MergeJavaResourceTaskTest",
    "//tools/base/build-system/integration-test/application:tests__MergeGeneratedProguardFilesTest",
    "//tools/base/build-system/integration-test/application:tests__MergeFileTaskTest",
    "//tools/base/build-system/integration-test/application:tests__MaxSdkVersionTest",
    "//tools/base/build-system/integration-test/application:tests__MatchingFallbackTest",
    "//tools/base/build-system/integration-test/application:tests__MappingFileAccessTest",
    "//tools/base/build-system/integration-test/application:tests__ManifestMergingTest",
    "//tools/base/build-system/integration-test/application:tests__LocalJarsTest",
    "//tools/base/build-system/integration-test/application:tests__LocalJarInAarInModelTest",
    "//tools/base/build-system/integration-test/application:tests__LocalAarTest",
    "//tools/base/build-system/integration-test/application:tests__LibsTestTest",
    "//tools/base/build-system/integration-test/application:tests__LibraryProfileContentTest",
    "//tools/base/build-system/integration-test/application:tests__LibraryIntermediateArtifactPublishingTest",
    "//tools/base/build-system/integration-test/application:tests__LibraryInstrumentationTestSigningTest",
    "//tools/base/build-system/integration-test/application:tests__LibraryCacheabilityTest",
    "//tools/base/build-system/integration-test/application:tests__LibraryBuildConfigTest",
    "//tools/base/build-system/integration-test/application:tests__LibraryApiJarPublishTest",
    "//tools/base/build-system/integration-test/application:tests__LibraryAarJarsTest",
    "//tools/base/build-system/integration-test/application:tests__LibWithResourcesTest",
    "//tools/base/build-system/integration-test/application:tests__LibWithProvidedLocalJarTest",
    "//tools/base/build-system/integration-test/application:tests__LibWithProvidedDirectJarTest",
    "//tools/base/build-system/integration-test/application:tests__LibWithProvidedAarAsJarTest",
    "//tools/base/build-system/integration-test/application:tests__LibWithPackageLocalJarTest",
    "//tools/base/build-system/integration-test/application:tests__LibWithNavigationTest",
    "//tools/base/build-system/integration-test/application:tests__LibWithLocalDepsTest",
    "//tools/base/build-system/integration-test/application:tests__LibWithCompileLocalJarTest",
    "//tools/base/build-system/integration-test/application:tests__LibTestDepTest",
    "//tools/base/build-system/integration-test/application:tests__LibProguardConsumerFilesTest",
    "//tools/base/build-system/integration-test/application:tests__LibMinifyTest",
    "//tools/base/build-system/integration-test/application:tests__LibMinifyLibDepTest",
    "//tools/base/build-system/integration-test/application:tests__LibMinifyJarDepTest",
    "//tools/base/build-system/integration-test/application:tests__LibDependencySourceChange",
    "//tools/base/build-system/integration-test/application:tests__L8DexDesugarTest",
    "//tools/base/build-system/integration-test/application:tests__KotlinWithEclipseSourceSetTest",
    "//tools/base/build-system/integration-test/application:tests__KotlinTestCompilationTest",
    "//tools/base/build-system/integration-test/application:tests__KotlinAppTest",
    "//tools/base/build-system/integration-test/application:tests__KaptTest",
    "//tools/base/build-system/integration-test/application:tests__JetifierTest",
    "//tools/base/build-system/integration-test/application:tests__JavaResPackagingTest",
    "//tools/base/build-system/integration-test/application:tests__JavaResMergePackagingTest",
    "//tools/base/build-system/integration-test/application:tests__JarJarTest",
    "//tools/base/build-system/integration-test/application:tests__JarJarLibTest",
    "//tools/base/build-system/integration-test/application:tests__JacocoWithKotlinTest",
    "//tools/base/build-system/integration-test/application:tests__JacocoWithButterKnifeTest",
    "//tools/base/build-system/integration-test/application:tests__JacocoTest",
    "//tools/base/build-system/integration-test/application:tests__JacocoOnlySubprojectBuildScriptDependency",
    "//tools/base/build-system/integration-test/application:tests__JacocoDependenciesTest",
    "//tools/base/build-system/integration-test/application:tests__InvalidResourceDirectoryTest",
    "//tools/base/build-system/integration-test/application:tests__InvalidNdkTest",
    "//tools/base/build-system/integration-test/application:tests__InjectedPreviewSdkTest",
    "//tools/base/build-system/integration-test/application:tests__InjectedDensityTest",
    "//tools/base/build-system/integration-test/application:tests__InjectedAbiTest",
    "//tools/base/build-system/integration-test/application:tests__InjectedAbiAndDensitySplitTest",
    "//tools/base/build-system/integration-test/application:tests__InitWithThisTest",
    "//tools/base/build-system/integration-test/application:tests__IncrementalJavaCompileWithAPsTest",
    "//tools/base/build-system/integration-test/application:tests__IncrementalDexingWithDesugaringTest",
    "//tools/base/build-system/integration-test/application:tests__IncrementalDexMergingTest",
    "//tools/base/build-system/integration-test/application:tests__IncrementalCodeChangeTest",
    "//tools/base/build-system/integration-test/application:tests__GuavaSpecialHandlingForTestTest",
    "//tools/base/build-system/integration-test/application:tests__GradleTestProjectTest",
    "//tools/base/build-system/integration-test/application:tests__GradlePropertiesTest",
    "//tools/base/build-system/integration-test/application:tests__GradlePluginMemoryLeakTest",
    "//tools/base/build-system/integration-test/application:tests__GenerateSourcesOnlyTest",
    "//tools/base/build-system/integration-test/application:tests__GenerateManifestJarTaskTest",
    "//tools/base/build-system/integration-test/application:tests__GenerateAnnotationsClassPathTest",
    "//tools/base/build-system/integration-test/application:tests__GenFolderKotlinOnlyApiTest",
    "//tools/base/build-system/integration-test/application:tests__GenFolderApiTest",
    "//tools/base/build-system/integration-test/application:tests__GenFolderApi2Test",
    "//tools/base/build-system/integration-test/application:tests__FullSplitsHandlingTest",
    "//tools/base/build-system/integration-test/application:tests__FlavorsTest",
    "//tools/base/build-system/integration-test/application:tests__FlavorlibTest",
    "//tools/base/build-system/integration-test/application:tests__FlavoredlibTest",
    "//tools/base/build-system/integration-test/application:tests__FlatJavaLibTest",
    "//tools/base/build-system/integration-test/application:tests__FeatureOnFeatureDependencyTest",
    "//tools/base/build-system/integration-test/application:tests__ExtractNativeLibsPackagingTest",
    "//tools/base/build-system/integration-test/application:tests__ExtractAnnotationTest",
    "//tools/base/build-system/integration-test/application:tests__ExternalTestProjectTest",
    "//tools/base/build-system/integration-test/application:tests__EmptyExtractAnnotationTest",
    "//tools/base/build-system/integration-test/application:tests__EarlyTaskConfigurationTest",
    "//tools/base/build-system/integration-test/application:tests__DynamicFeaturesCacheabilityTest",
    "//tools/base/build-system/integration-test/application:tests__DynamicFeatureUnitTestSanityTest",
    "//tools/base/build-system/integration-test/application:tests__DynamicFeatureJavaResTest",
    "//tools/base/build-system/integration-test/application:tests__DynamicFeatureDependsOnJavaLibTest",
    "//tools/base/build-system/integration-test/application:tests__DynamicFeatureAndroidTestBuildTest",
    "//tools/base/build-system/integration-test/application:tests__DynamicAppPackageDependenciesTest",
    "//tools/base/build-system/integration-test/application:tests__DynamicAppMultidexTest",
    "//tools/base/build-system/integration-test/application:tests__DynamicAppLintTest",
    "//tools/base/build-system/integration-test/application:tests__DxFeaturesTest",
    "//tools/base/build-system/integration-test/application:tests__DuplicateModuleNameImportTest",
    "//tools/base/build-system/integration-test/application:tests__DuplicateClassesTest",
    "//tools/base/build-system/integration-test/application:tests__DslTest",
    "//tools/base/build-system/integration-test/application:tests__DisabledSrcResGenTest",
    "//tools/base/build-system/integration-test/application:tests__DisableLibraryResourcesTest",
    "//tools/base/build-system/integration-test/application:tests__DifferentProjectClassLoadersTest",
    "//tools/base/build-system/integration-test/application:tests__DexingArtifactTransformWithTransformApiTest",
    "//tools/base/build-system/integration-test/application:tests__DexingArtifactTransformTest",
    "//tools/base/build-system/integration-test/application:tests__DexingArtifactTransformMultiModuleTest",
    "//tools/base/build-system/integration-test/application:tests__DexLimitTest",
    "//tools/base/build-system/integration-test/application:tests__DexArchivesTest",
    "//tools/base/build-system/integration-test/application:tests__DexArchivesKotlinTest",
    "//tools/base/build-system/integration-test/application:tests__DeterministicTaskOutputsTest",
    "//tools/base/build-system/integration-test/application:tests__DeterministicApkTest",
    "//tools/base/build-system/integration-test/application:tests__DeprecatedConfigurationTest",
    "//tools/base/build-system/integration-test/application:tests__DeploymentApiOverrideTest",
    "//tools/base/build-system/integration-test/application:tests__DependencyReportDslTest",
    "//tools/base/build-system/integration-test/application:tests__DependencyOrderTest",
    "//tools/base/build-system/integration-test/application:tests__DependencyCheckerTest",
    "//tools/base/build-system/integration-test/application:tests__DependenciesReportTest",
    "//tools/base/build-system/integration-test/application:tests__DependenciesFilePublicOutputTest",
    "//tools/base/build-system/integration-test/application:tests__DepOnLocalJarThroughAModuleTest",
    "//tools/base/build-system/integration-test/application:tests__DensitySplitWithPublishNonDefaultTest",
    "//tools/base/build-system/integration-test/application:tests__DensitySplitTest",
    "//tools/base/build-system/integration-test/application:tests__D8DexingTest",
    "//tools/base/build-system/integration-test/application:tests__D8DesugaringTest",
    "//tools/base/build-system/integration-test/application:tests__D8DesugarMethodsTest",
    "//tools/base/build-system/integration-test/application:tests__CustomArtifactDepTest",
    "//tools/base/build-system/integration-test/application:tests__CrashlyticsTest",
    "//tools/base/build-system/integration-test/application:tests__CoreLibraryDesugarGeneralizationTest",
    "//tools/base/build-system/integration-test/application:tests__CoreLibraryDesugarDynamicFeatureTest",
    "//tools/base/build-system/integration-test/application:tests__CoreLibraryDesugarCachingTest",
    "//tools/base/build-system/integration-test/application:tests__ConditionalKeepRulesTest",
    "//tools/base/build-system/integration-test/application:tests__CompoundSyncModelBuilderTest",
    "//tools/base/build-system/integration-test/application:tests__CompositeBuildTest",
    "//tools/base/build-system/integration-test/application:tests__ComposeHelloWorldTest",
    "//tools/base/build-system/integration-test/application:tests__ComposeFlagsTest",
    "//tools/base/build-system/integration-test/application:tests__ComposeCompilerFlagsTest",
    "//tools/base/build-system/integration-test/application:tests__CompileSdkAndLanguageLevelTest",
    "//tools/base/build-system/integration-test/application:tests__CompileRClassFlowTest",
    "//tools/base/build-system/integration-test/application:tests__CompileLibraryResourcesTest",
    "//tools/base/build-system/integration-test/application:tests__CompileAndRuntimeClasspathTest",
    "//tools/base/build-system/integration-test/application:tests__CleanBuildTaskStatesTest",
    "//tools/base/build-system/integration-test/application:tests__CleanBuildCacheTest",
    "//tools/base/build-system/integration-test/application:tests__CheckMultiApkLibrariesTaskTest",
    "//tools/base/build-system/integration-test/application:tests__CheckAarMetadataTaskTest",
    "//tools/base/build-system/integration-test/application:tests__CacheabilityTest",
    "//tools/base/build-system/integration-test/application:tests__BytecodeGenerationHooksTest",
    "//tools/base/build-system/integration-test/application:tests__ButterKnifeTest",
    "//tools/base/build-system/integration-test/application:tests__BundleOptionsTest",
    "//tools/base/build-system/integration-test/application:tests__BundleLibraryJavaResTest",
    "//tools/base/build-system/integration-test/application:tests__BuiltArtifactsWithWorkerTest",
    "//tools/base/build-system/integration-test/application:tests__BuilderTestingApiTest",
    "//tools/base/build-system/integration-test/application:tests__BuildToolsTest",
    "//tools/base/build-system/integration-test/application:tests__BuildFeaturesTest",
    "//tools/base/build-system/integration-test/application:tests__BuildDirTest",
    "//tools/base/build-system/integration-test/application:tests__BuildDirRelocationTest",
    "//tools/base/build-system/integration-test/application:tests__BuildConfigTest",
    "//tools/base/build-system/integration-test/application:tests__BrokenTestModuleSyncTest",
    "//tools/base/build-system/integration-test/application:tests__BootClasspathTest",
    "//tools/base/build-system/integration-test/application:tests__BasicTest2",
    "//tools/base/build-system/integration-test/application:tests__BasicTest",
    "//tools/base/build-system/integration-test/application:tests__BasicMultiFlavorTest",
    "//tools/base/build-system/integration-test/application:tests__BasicModelV2Test",
    "//tools/base/build-system/integration-test/application:tests__BasicKotlinDslTest",
    "//tools/base/build-system/integration-test/application:tests__BasicInstantExecutionTest",
    "//tools/base/build-system/integration-test/application:tests__AutoServiceTest",
    "//tools/base/build-system/integration-test/application:tests__AutoNamespaceTest",
    "//tools/base/build-system/integration-test/application:tests__AutoEnableMultidexTest",
    "//tools/base/build-system/integration-test/application:tests__AttrOrderTest",
    "//tools/base/build-system/integration-test/application:tests__AssetPackagingTest",
    "//tools/base/build-system/integration-test/application:tests__AssetPackTest",
    "//tools/base/build-system/integration-test/application:tests__ArtifactReplacementTest",
    "//tools/base/build-system/integration-test/application:tests__ArtifactApiTest",
    "//tools/base/build-system/integration-test/application:tests__ArchivesBaseNameTest",
    "//tools/base/build-system/integration-test/application:tests__ApplicationIdTest",
    "//tools/base/build-system/integration-test/application:tests__ApplicationIdReset",
    "//tools/base/build-system/integration-test/application:tests__ApplicationIdInLibsTest",
    "//tools/base/build-system/integration-test/application:tests__ApplibtestTest",
    "//tools/base/build-system/integration-test/application:tests__AppWithRuntimeDependencyTest",
    "//tools/base/build-system/integration-test/application:tests__AppWithResolutionStrategyForJarTest",
    "//tools/base/build-system/integration-test/application:tests__AppWithResolutionStrategyForAarTest",
    "//tools/base/build-system/integration-test/application:tests__AppWithProvidedRemoteJarTest",
    "//tools/base/build-system/integration-test/application:tests__AppWithProvidedProjectJarTest",
    "//tools/base/build-system/integration-test/application:tests__AppWithProvidedLocalJarTest",
    "//tools/base/build-system/integration-test/application:tests__AppWithProvidedLocalAarTest",
    "//tools/base/build-system/integration-test/application:tests__AppWithProvidedLibTest",
    "//tools/base/build-system/integration-test/application:tests__AppWithProvidedAarAsJarTest",
    "//tools/base/build-system/integration-test/application:tests__AppWithPackageLocalJarTest",
    "//tools/base/build-system/integration-test/application:tests__AppWithPackageDirectJarTest",
    "//tools/base/build-system/integration-test/application:tests__AppWithNonExistentResolutionStrategyForAarTest",
    "//tools/base/build-system/integration-test/application:tests__AppWithJarDependOnLibTest",
    "//tools/base/build-system/integration-test/application:tests__AppWithIvyDependencyTest",
    "//tools/base/build-system/integration-test/application:tests__AppWithCompileLocalAarTest",
    "//tools/base/build-system/integration-test/application:tests__AppWithCompileLibTest",
    "//tools/base/build-system/integration-test/application:tests__AppWithCompileIndirectJavaProjectTest",
    "//tools/base/build-system/integration-test/application:tests__AppWithCompileIndirectJarTest",
    "//tools/base/build-system/integration-test/application:tests__AppWithCompileDirectJarTest",
    "//tools/base/build-system/integration-test/application:tests__AppWithClassifierDepTest",
    "//tools/base/build-system/integration-test/application:tests__AppWithAndroidTestDependencyOnLibTest",
    "//tools/base/build-system/integration-test/application:tests__AppTestWithSkippedModuleDepTest",
    "//tools/base/build-system/integration-test/application:tests__AppPublishingTest",
    "//tools/base/build-system/integration-test/application:tests__AppModelTest",
    "//tools/base/build-system/integration-test/application:tests__AppIntegrityConfigTest",
    "//tools/base/build-system/integration-test/application:tests__AppAndLibNoBuildConfigTest",
    "//tools/base/build-system/integration-test/application:tests__ApkOutputFileChangeTest",
    "//tools/base/build-system/integration-test/application:tests__ApkLocationTest",
    "//tools/base/build-system/integration-test/application:tests__ApkCreatedByTest",
    "//tools/base/build-system/integration-test/application:tests__ApiTest",
    "//tools/base/build-system/integration-test/application:tests__AnnotationProcessorTest",
    "//tools/base/build-system/integration-test/application:tests__AnnotationProcessorCompileClasspathTest",
    "//tools/base/build-system/integration-test/application:tests__AndroidXPropertySyncIssueTest",
    "//tools/base/build-system/integration-test/application:tests__AndroidTestUtilTest",
    "//tools/base/build-system/integration-test/application:tests__AndroidTestResourcesTest",
    "//tools/base/build-system/integration-test/application:tests__AndroidTestClasspathTest",
    "//tools/base/build-system/integration-test/application:tests__AndroidManifestInTestTest",
    "//tools/base/build-system/integration-test/application:tests__AnalyticsConfigurationCachingTest",
    "//tools/base/build-system/integration-test/application:tests__AidlTest",
    "//tools/base/build-system/integration-test/application:tests__AgpVersionCheckerTest",
    "//tools/base/build-system/integration-test/application:tests__AccentCharacterAndProguardTest",
    "//tools/base/build-system/integration-test/application:tests__AbiRelatedDslUsageTest",
    "//tools/base/build-system/integration-test/application:tests__AarWithLocalJarsTest",
    "//tools/base/build-system/integration-test/application:tests__AarMetadataTaskTest",
    "//tools/base/build-system/integration-test/application:tests__AarApiJarTest",
    "//tools/base/build-system/integration-test/application:tests__AaptOptionsTest",
    "//tools/base/build-system/integration-test/api:tests",
    "//tools/adt/idea/sync-perf-tests:intellij.android.sync-perf-tests_tests__all",
    "//tools/adt/idea/studio:searchable_options_test",
    "//tools/adt/idea/old-agp-tests:intellij.android.old-agp-tests_tests",
    "//tools/adt/idea/ide-perf-tests:intellij.android.ide-perf-tests_tests__all",
    "//tools/adt/idea/designer-perf-tests:intellij.android.designer-perf-tests_tests",
    "//tools/adt/idea/android-uitests:X86AbiSplitApksTest",
    "//tools/adt/idea/android-uitests:WatchpointTest",
    "//tools/adt/idea/android-uitests:SmartStepIntoTest",
    "//tools/adt/idea/android-uitests:SessionRestartTest",
    "//tools/adt/idea/android-uitests:RunInstrumentationTest",
    "//tools/adt/idea/android-uitests:NativeDebuggerInNdkProjectTest",
    "//tools/adt/idea/android-uitests:NativeDebuggerBreakpointsTest",
    "//tools/adt/idea/android-uitests:JavaDebuggerTest",
    "//tools/adt/idea/android-uitests:InstrumentationTest",
    "//tools/adt/idea/android-uitests:InstantAppRunFromCmdLineTest",
    "//tools/adt/idea/android-uitests:ImportAndRunInstantAppTest",
    "//tools/adt/idea/android-uitests:FlavorsExecutionTest",
    "//tools/adt/idea/android-uitests:EspressoRecorderTest",
    "//tools/adt/idea/android-uitests:DualDebuggerInNdkProjectTest",
    "//tools/adt/idea/android-uitests:DualDebuggerBreakpointsTest",
    "//tools/adt/idea/android-uitests:DebugOnEmulatorTest",
    "//tools/adt/idea/android-uitests:CreateAndRunInstantAppTest",
    "//tools/adt/idea/android-uitests:CreateAPKProjectTest",
    "//tools/adt/idea/android-uitests:BuildAndRunCMakeProjectTest",
    "//tools/adt/idea/android-uitests:AutoDebuggerInNdkProjectTest",
    "//tools/adt/idea/android-uitests:AbiSplitApksTest",
    "//tools/adt/idea/android-templates:intellij.android.templates.tests_tests",
    "//tools/adt/idea/android:intellij.android.core.tests_tests__testartifacts",
    "//tools/adt/idea/android:intellij.android.core.tests_tests__other",
    "//tools/adt/idea/android:intellij.android.core.tests_tests__navigator",
    "//tools/adt/idea/android:intellij.android.core.tests_tests__jetbrains",
    "//tools/adt/idea/android:intellij.android.core.tests_tests__gradle.structure.model.android",
    "//tools/adt/idea/android:intellij.android.core.tests_tests__gradle.structure",
    "//tools/adt/idea/android:intellij.android.core.tests_tests__gradle.project.sync.snapshots",
    "//tools/adt/idea/android:intellij.android.core.tests_tests__gradle.project.sync",
    "//tools/adt/idea/android:intellij.android.core.tests_tests__gradle",
]

FAILURE_MESSAGE = """Test target {} has timeout set to eternal.
We do not want any new target with eternal timeout (b/162943254).
If this is intentional, contact android-devtools-infra@ to relax the restriction on the target."""

IGNORE_TAG = ["perfgate"]

def _has_intersect(this, other):
    for item in this:
        if item in other:
            return True
    return False

def _no_eternal_tests_impl(target, ctx):
    if ctx.rule.kind.endswith("_test"):
        if ctx.rule.attr.timeout == "eternal" and str(ctx.label) not in APPROVED_ETERNAL_TESTS:
            if not _has_intersect(IGNORE_TAG, ctx.rule.attr.tags):
                fail(FAILURE_MESSAGE.format(str(ctx.label)))
    return []

no_eternal_tests = aspect(
    implementation = _no_eternal_tests_impl,
    attr_aspects = [],
)
